<!DOCTYPE html>
<html>
	<head>
		<title>
			Game
		</title>
		<a>
			<img id = "paladinRight" src = "img/Paladin.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "paladinLeft" src = "img/Paladin1.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "paladinDeadRight" src = "img/PaladinDeath.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "paladinDeadLeft" src = "img/PaladinDeath1.png" style = "width:10px; height:10px; display: none;" ></img>
			
			<img id = "mageRight" src = "img/Mage.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "mageLeft" src = "img/Mage1.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "mageDeadRight" src = "img/MageDeath.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "mageDeadLeft" src = "img/MageDeath1.png" style = "width:10px; height:10px; display: none;" ></img>

			<img id = "archerRight" src = "img/Archer.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "archerLeft" src = "img/Archer1.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "archerDeadRight" src = "img/ArcherDeath.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "archerDeadLeft" src = "img/ArcherDeath1.png" style = "width:10px; height:10px; display: none;" ></img>

			<img id = "hammerImageAnchor" src = "img/Hammer.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "magePriProjectile" src = "img/MagePrimary.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "mageSecProjectile" src = "img/MageSecondary.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "mageUltProjectile" src = "img/MageUltProjectile.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "archerArrowProjectile" src = "img/ArcherArrow.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "archerUltProjectile" src = "img/ArcherUlt.png" style = "width:10px; height:10px; display: none;" ></img>

			<img id = "paladinShockwaveEffect" src = "img/PaladinShockwaveParticleEffect.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "paladinUltEffect" src = "img/PaladinUltParticleEffect.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "paladinHealEffect" src = "img/PaladinHealParticleEffect.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "mageBarrierEffect" src = "img/MageBarrierEffect.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "archerPowerUpEffect" src = "img/ArcherPowerUp.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "archerMarkEffect" src = "img/ArcherMark.png" style = "width:10px; height:10px; display: none;" ></img>
			
			<img id = "iconFrame" src = "img/AbilitySlot.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "iconPaladinQ" src = "img/IconPaladinQ.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "iconPaladinE" src = "img/IconPaladinE.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "iconPaladinR" src = "img/IconPaladinR.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "iconMageQ" src = "img/IconMageQ.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "iconMageE" src = "img/IconMageE.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "iconMageR" src = "img/IconMageR.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "iconArcherQ" src = "img/IconArcherQ.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "iconArcherE" src = "img/IconArcherE.png" style = "width:10px; height:10px; display: none;" ></img>
			<img id = "iconArcherR" src = "img/IconArcherR.png" style = "width:10px; height:10px; display: none;" ></img>
		</a>
		
	</head>

	<div id="loginDiv">
		Username: <input id="loginUsername" type="text"></input><br>
		Password: <input id="loginPassword" type="password"></input>
		<p>
				Pick a class:
		</p>
		<select id = "classPicker">
				<option value="paladin">Paladin</option>
				<option value="mage">Mage</option>
				<option value="archer">Archer</option>
			</select>
			<button id="loginButton">Login</button>
			<button id="signupButton">Sign Up</button>
		</div>
		
		<body>
			<p id ="priattackdesc";></p>
			<p id ="secattackdesc";></p>
			<p id ="qdesc";></p>
			<p id ="edesc";></p>
			<p id ="rdesc";></p>
		</body >

	<div id="gameDiv">
		<canvas id="myCanvas" width="980" height="540" style = "border:5px solid grey;background-color:#d3d3d3;" ></canvas>
	</div>

	<script src = "https://cdn.socket.io/socket.io-1.4.5.js"></script>

	<script>
		var socket = io ('https://multiplayer-game-1.herokuapp.com/');
		var canvas = document.getElementById ("myCanvas");
		var ctx = canvas.getContext ("2d");
		
		//Note: DO NOT remove the style from the image anchor, although useless, it ruins it for some reason?
		var paladinImage = 	[document.getElementById("paladinRight"), 
							document.getElementById("paladinLeft"), 
							document.getElementById("paladinDeadRight"), 
							document.getElementById("paladinDeadLeft")]; 

		var mageImage = [document.getElementById("mageRight"), 
						document.getElementById("mageLeft"), 
						document.getElementById("mageDeadRight"), 
						document.getElementById("mageDeadLeft")]; 

		var archerImage = 	[document.getElementById("archerRight"),
							document.getElementById("archerLeft"),
							document.getElementById("archerDeadRight"),
							document.getElementById("archerDeadLeft")];

		var projectileImages = 	[document.getElementById ("hammerImageAnchor"),
								document.getElementById ("magePriProjectile"),
								document.getElementById ("mageSecProjectile"),
								document.getElementById ("mageUltProjectile"),
								document.getElementById ("archerArrowProjectile"),
								document.getElementById ("archerUltProjectile")];

		var particleEffectImages = 	[document.getElementById ("paladinHealEffect"),
									document.getElementById ("paladinShockwaveEffect"),
									document.getElementById ("paladinUltEffect"),
									document.getElementById ("mageBarrierEffect"),
									document.getElementById ("archerPowerUpEffect"),
									document.getElementById ("archerMarkEffect")];

		var iconImages = 	[document.getElementById ("iconPaladinQ"),
							document.getElementById ("iconPaladinE"),
							document.getElementById ("iconPaladinR"),
							document.getElementById ("iconMageQ"),
							document.getElementById ("iconMageE"),
							document.getElementById ("iconMageR"),
							document.getElementById ("iconArcherQ"),
							document.getElementById ("iconArcherE"),
							document.getElementById ("iconArcherR")];

		var loginNameElement = document.getElementById ("loginUsername");
		var loginPasswordElement = document.getElementById ("loginPassword");

		var loginButton = document.getElementById ("loginButton");
		var signUpButton = document.getElementById ("signupButton");

		var classPicker = document.getElementById ("classPicker");

		var connected = false;

		loginButton.onclick = function () {
			socket.emit ("login",{username: loginNameElement.value, password: loginPasswordElement.value, class: classPicker.value});
		};

		signUpButton.onclick = function () {
			socket.emit ("signup",{username: loginNameElement.value, password: loginPasswordElement.value, class: classPicker.value});
		};

		var localPlayerID;
		socket.on ('sendResult', function (data) {
				localPlayerID = data.id;
				console.log (localPlayerID);
				connected = data.connected;
				usernameAvailable= data.username;//TO check if username is available.
				if (connected) {
					loginButton.disabled = true;
					signUpButton.disabled = true;
					loginNameElement.disabled = true;
					loginPasswordElement.disabled = true;
					classPicker.disabled = true;
					document.getElementById("loginDiv").innerHTML = "<h2>Welcome " + (data.player.name).toUpperCase() + "<span style = color:blue;margin-left:6em;>First team to get 10 kills WINS!!!!! </span><span style = float:right;> Your Team : " +data.player.team+"</span></h2><h3 id=kills style=color:green;><span style = float:right;></span></h3><h3 id=team2score style = float:right;color:red;></h3>";
				} 
				else if (!usernameAvailable){
					window.alert("     Username Already Taken\n          Try Again");
				}
				else {
					window.alert("     Wrong Username or Password\n          Try Again\n     If you are new SIGN UP");
				
				}
		});

		ctx.font = "30px Arial";

		document.addEventListener('contextmenu', event => event.preventDefault());

		var localPlayerx = 0;
		var localPlayery = 0;

		socket.on ('sendPositionData',function (data) //This receives the data on the players movement and renders each and single player
		{
			var localPlayer;

			if (connected){
				ctx.clearRect (0,0,1000,540);

				for (var i = 0; i < data.playerDataPack.length; i++)
				{
					var player = data.playerDataPack [i]; 
					if (player.id == localPlayerID) {
            			localPlayer = player;
						if (player.team == 1){
							document.getElementById("kills").innerHTML = "Your Kills : "+player.kills+"<span style = float:right; color:green;> Your Team Kills : "+player.team1Score+"</span>"
							document.getElementById("team2score").innerHTML = "Opposite Team kills : "+player.team2Score
					
						}
						else{ 
							document.getElementById("kills").innerHTML = "Your Kills : "+player.kills+"<span style = float:right; color:green;> Your Team Kills : "+player.team2Score+"</span>"
							document.getElementById("team2score").innerHTML = "Opposite Team kills : "+player.team1Score
					
						}
						
					} else {

					}

					if (player.team == 1)
						ctx.fillStyle = "#0000A0";
					else 
						ctx.fillStyle = "#A00000";
				
					ctx.fillText ( player.name, player.x - 80, player.y - 100);
					ctx.fillStyle = "#FF0000" ;
					ctx.fillRect ( player.x - 80, player.y - 90, 100, 5 ); 
					ctx.fillStyle = "#00FF00" ;
					ctx.fillRect ( player.x - 80, player.y - 90, (player.currentHealth/player.maxHealth) * 100, 5 );
					
					if (player.class == "Paladin") {
						if (!player.isRight) {
							if (!player.isdead)
								ctx.drawImage ( paladinImage[1], player.x - 120, player.y - 80, 160, 160);
							else 
								ctx.drawImage ( paladinImage[3], player.x - 80, player.y - 80, 160, 160);
						} else {
							if (!player.isdead)
								ctx.drawImage ( paladinImage[0], player.x - 80, player.y - 80, 160, 160);
							else
								ctx.drawImage ( paladinImage[2], player.x - 80, player.y - 80, 160, 160);
						}
					} else if (player.class == "Mage") {
						if (!player.isRight) {
							if (!player.isdead)
								ctx.drawImage ( mageImage[1], player.x - 120, player.y - 80, 160, 160);
							else 
								ctx.drawImage ( mageImage[3], player.x - 80, player.y - 80, 160, 160);
						} else {
							if (!player.isdead)
								ctx.drawImage ( mageImage[0], player.x - 80, player.y - 80, 160, 160);
							else
								ctx.drawImage ( mageImage[2], player.x - 80, player.y - 80, 160, 160);
						}
					} else if (player.class == "Archer") {
						if (!player.isRight) {
							if (!player.isdead)
								ctx.drawImage ( archerImage[1], player.x - 120, player.y - 80, 160, 160);
							else 
								ctx.drawImage ( archerImage[3], player.x - 80, player.y - 80, 160, 160);
						} else {
							if (!player.isdead)
								ctx.drawImage ( archerImage[0], player.x - 80, player.y - 80, 160, 160);
							else
								ctx.drawImage ( archerImage[2], player.x - 80, player.y - 80, 160, 160);
						}
					}
				}
				}

				for (var i = 0; i < data.particleEffectDataPack.length; i++) {
					var particle = data.particleEffectDataPack [i];
					ctx.drawImage (particleEffectImages[particle.id], particle.x-60, particle.y-60, 120, 120);
				}

				for (var i = 0; i < data.projectileDataPack.length; i++)
				{
					var projectile = data.projectileDataPack [i];
					if (projectile.id >= 0)
						ctx.drawImage (projectileImages[projectile.id], projectile.x - projectile.rad/2, projectile.y - projectile.rad/2, projectile.rad, projectile.rad);
				}
				if (localPlayer.class == "Paladin"){
					document.getElementById("priattackdesc").innerHTML = "PRIMARY ATTACK: A powerful, melee attack.";
					document.getElementById("secattackdesc").innerHTML = "SECONDARY ATTACK: A slow, ranged attack.";
					document.getElementById("qdesc").innerHTML = "Q: Heal for 35% missing health and remove stuns.";
					document.getElementById("edesc").innerHTML = "E: Charge at mouse direction, creating a shockwave at the end that deals damage and stuns enemies.";
					document.getElementById("rdesc").innerHTML = "R: For 5 seconds, two-thirds of all damage taken is also reflected to the attacker.";
					if (localPlayer.cd1 <= 0)
						ctx.drawImage (iconImages[0], 50, 475, 64, 64);
					else {
						ctx.fillStyle = "#000000";
						ctx.fillRect (50, 475, 64, 64);
						ctx.fillStyle = "#FFFFFF";
						ctx.fillText (localPlayer.cd1/25, 50, 525);
					}

					if (localPlayer.cd2 <= 0)
						ctx.drawImage (iconImages[1], 150, 475, 64, 64);
					else {
						ctx.fillStyle = "#000000";
						ctx.fillRect (150, 475, 64, 64);
						ctx.fillStyle = "#FFFFFF";
						ctx.fillText (localPlayer.cd2/25, 150, 525);
					}

					if (localPlayer.cd3 <= 0)
						ctx.drawImage (iconImages[2], 250, 475, 64, 64);
					else {
						ctx.fillStyle = "#000000";
						ctx.fillRect (250, 475, 64, 64);
						ctx.fillStyle = "#FFFFFF";
						ctx.fillText (localPlayer.cd3/25, 250, 525);
					}							
				} else if (localPlayer.class == "Mage") {
					document.getElementById("priattackdesc").innerHTML = "PRIMARY ATTACK: A quick, ranged attack that builds up mana.";
					document.getElementById("secattackdesc").innerHTML = "SECONDARY ATTACK: A ranged attack that consumes built up mana to gain size, damage, and speed.";
					document.getElementById("qdesc").innerHTML = "Q: Creates a barrier for 2 seconds that converts all damage taken into healing.";
					document.getElementById("edesc").innerHTML = "E: Teleport to mouse location.";
					document.getElementById("rdesc").innerHTML = "R: For 4 seconds, create an area around you that constantly damages enemies in it.";
					if (localPlayer.cd1 <= 0)
						ctx.drawImage (iconImages[3], 50, 475, 64, 64);
					else {
						ctx.fillStyle = "#000000";
						ctx.fillRect (50, 475, 64, 64);
						ctx.fillStyle = "#FFFFFF";
						ctx.fillText (localPlayer.cd1/25, 50, 525);
					}

					if (localPlayer.cd2 <= 0)
						ctx.drawImage (iconImages[4], 150, 475, 64, 64);
					else {
						ctx.fillStyle = "#000000";
						ctx.fillRect (150, 475, 64, 64);
						ctx.fillStyle = "#FFFFFF";
						ctx.fillText (localPlayer.cd2/25, 150, 525);
					}

					if (localPlayer.cd3 <= 0)
						ctx.drawImage (iconImages[5], 250, 475, 64, 64);
					else {
						ctx.fillStyle = "#000000";
						ctx.fillRect (250, 475, 64, 64);
						ctx.fillStyle = "#FFFFFF";
						ctx.fillText (localPlayer.cd3/25, 250, 525);
					}
				} else if (localPlayer.class == "Archer") {
					document.getElementById("priattackdesc").innerHTML = "PRIMARY ATTACK: A quick, ranged attack.";
					document.getElementById("secattackdesc").innerHTML = "SECONDARY ATTACK: Fire three slow shots.";
					document.getElementById("qdesc").innerHTML = "Q: Triple the rate of fire for 4 seconds.";
					document.getElementById("edesc").innerHTML = "E: Attacks mark enemies. Only one mark can exist at a time. Activate to consume that mark and stun the target.";
					document.getElementById("rdesc").innerHTML = "R: Fire a quick arrow that executes the first enemy hit if they're below 50% health.";
					if (localPlayer.cd1 <= 0)
						ctx.drawImage (iconImages[6], 50, 475, 64, 64);
					else {
						ctx.fillStyle = "#000000";
						ctx.fillRect (50, 475, 64, 64);
						ctx.fillStyle = "#FFFFFF";
						ctx.fillText (localPlayer.cd1/25, 50, 525);
					}

					if (localPlayer.cd2 <= 0)
						ctx.drawImage (iconImages[7], 150, 475, 64, 64);
					else {
						ctx.fillStyle = "#000000";
						ctx.fillRect (150, 475, 64, 64);
						ctx.fillStyle = "#FFFFFF";
						ctx.fillText (localPlayer.cd2/25, 150, 525);
					}

					if (localPlayer.cd3 <= 0)
						ctx.drawImage (iconImages[8], 250, 475, 64, 64);
					else {
						ctx.fillStyle = "#000000";
						ctx.fillRect (250, 475, 64, 64);
						ctx.fillStyle = "#FFFFFF";
						ctx.fillText (localPlayer.cd3/25, 250, 525);
					}
				}
		});
    
		//For game over.
		socket.on ('gameOver',function(path){
			console.log("game over")
			document.writeln("<h1 style =text-align:center;height:5em;>Game over</h1>")
			if (path.team1Score > path.team2Score){
				if(path.player.team == 1){
					document.writeln("<h1 style = text-align:center;color:blue;>Team 1 Wins </h1>")
					document.writeln("<h2 style = text-align:center;color:green;>Congratulations Your Team Won!!!<h2>")
					document.writeln("<h3 style = text-align:center;>Your Team Total Kills : "+ path.team1Score +"</h3>")
					console.log("Team1 Wins")
				}
				else if (path.player.team == 2){
					document.writeln("<h1 style =text-align:center;color:blue;>Team 1 Wins </h1>")
					document.writeln("<h2 style =text-align:center;color:red;>Oppss Your team lost !!!</h2>")
					document.writeln("<h3 style =text-align:center;>Your Team Total Kills : "+ path.team2Score +"</h3>")
					console.log("Team1 Wins")
				}
			}
			else {
				if(path.player.team == 1){
					document.writeln("<h1 style =text-align:center;color:blue;>Team 2 Wins</h1>")
					document.writeln("<h2 style =text-align:center;color:red;>Opps Your Team Lost!!!</h2>")
					document.writeln("<h3 style =text-align:center;>Your Team Total Kills : "+ path.team1Score +"</h3>")
					console.log("Team2 Wins")
				}
				else if (path.player.team == 2){
					document.writeln("<h1 style =text-align:center;color:blue;>Team 2 Wins</h1>")
					document.writeln("<h2 style =text-align:center;color:green;>Congratulations Your Team Won!!!</h2>")
					document.writeln("<h3 style =text-align:center;>Your Team Total Kills : "+ path.team2Score +"</h3>")
					console.log("Team2 Wins")
				}
			}
			document.writeln("<h3 style =text-align:center;>Your Total Kills : "+ path.player.kills +"</h3>")
			socket.disconnect();
		});

		var moveDirs = [false, false, false, false]; //Movement input directions

		function sendMoveInput () { //This sends the data to the server
			if (connected){
				socket.emit ('sendMoveDirs', {
					moveDirections: moveDirs
				});
			}
		}

		function sendSpellInput (spellNumber) {
			if (connected){
				socket.emit ('sendSpellInput', {
					spellNumber: spellNumber
				});
			}
		}
		
		//This is just input
		function keyPress (e) {
			switch (e.keyCode) {
				case 87:
					moveDirs [3] = true;
					sendMoveInput ();
					break;
				case 83:
					moveDirs [2] = true;
					sendMoveInput ();
					break;
				case 65:
					moveDirs [1] = true;
					sendMoveInput ();
					break;
				case 68:
					moveDirs [0] = true;
					sendMoveInput ();
					break;	
			}

			if (e.keyCode == 81) {
				sendSpellInput (0);
			} else if (e.keyCode == 69) {
				sendSpellInput (1);
			} else if (e.keyCode == 82) {
				sendSpellInput (2);
			}

		}

		function keyLift (e) {
			switch (e.keyCode) {
				case 87:
					moveDirs [3] = false;
					sendMoveInput ();
					break;
				case 83:
					moveDirs [2] = false;
					sendMoveInput ();
					break;
				case 65:
					moveDirs [1] = false;
					sendMoveInput ();
					break;
				case 68:
					moveDirs [0] = false;
					sendMoveInput ();
					break;	
			}
		}

		var attackClick = [false, false];
		function sendAttackInput () { //This sends the attack (based on click) data to the server via socket.
			if (connected){
				socket.emit ('sendAttackInput', {
					primary: attackClick [0], 
					secondary: attackClick [1]
				});
			}
		}

		function attackDown(event) {
			switch (event.button){
				case 0:   // 0 is the number for left click, which is the primary attack.
					attackClick[0] = true; //this disables the primary attack when click is lifted.
					sendAttackInput();
					break;
				case 2:    //2 is the number for right click, which is the secondary attack.
					attackClick[1] = true; //
					sendAttackInput(); //this disables the secondary attack when click is lifted.
					break;
			}	
		}

		function clickLifted(event) {
			switch (event.button){
				case 0:   // 0 is the number for left click, which is the primary attack.
					attackClick[0] = false; //this disables the primary attack when click is lifted.
					sendAttackInput();
					break;
				case 2:    //2 is the number for right click, which is the secondary attack.
					attackClick[1] = false; //
					sendAttackInput(); //this disables the secondary attack when click is lifted.
					break ;
			}
		}
		function mousePosition(event){
			var positionX = event.clientX;
			var positionY = event.clientY;

			if (connected){
				socket.emit("sendMousePosition", {
					x: positionX,
					y: positionY
				});	
			}
		}

		document.onkeydown = keyPress;
		document.onkeyup = keyLift;
		document.onmouseup = clickLifted;
		document.onmousedown = attackDown;
		document.onmousemove = mousePosition;
	</script>

</html>